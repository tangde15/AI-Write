# 🚀 如何运行系统（包含对比功能）

## 📋 重要提示
由于新增了作文对比功能，**如果数据库已经存在**，需要先执行数据库迁移。

---

## 🗄️ 第一步：数据库迁移（重要！）

### 如果数据库是新创建的
直接使用更新后的 `schema.sql`，所有字段都已包含。

### 如果数据库已经存在（需要迁移）

#### 方法1：重新创建数据库（推荐） ⭐
```bash
# 1. 备份现有数据（如果需要）
mysqldump -u root -p ai_writing_db > backup.sql

# 2. 删除旧数据库
mysql -u root -p -e "DROP DATABASE ai_writing_db;"

# 3. 重新创建数据库
mysql -u root -p < CREATE_DATABASE.sql

# 4. 执行schema.sql（已包含新字段）
mysql -u root -p ai_writing_db < backend/src/main/resources/schema.sql
```

#### 方法2：手动添加字段（保留数据）
```bash
# 连接到MySQL
mysql -u root -p ai_writing_db

# 执行以下SQL语句
```

```sql
-- 添加score字段（如果不存在）
ALTER TABLE writing_record ADD COLUMN IF NOT EXISTS score INT;

-- 添加previous_record_id字段
ALTER TABLE writing_record ADD COLUMN IF NOT EXISTS previous_record_id BIGINT;

-- 添加comparison_analysis字段
ALTER TABLE writing_record ADD COLUMN IF NOT EXISTS comparison_analysis TEXT;

-- 查看表结构确认
DESC writing_record;
```

#### 方法3：使用自动迁移
Spring Boot的 `ddl-auto: update` 会自动检测并添加新字段，但建议使用上面的方法以确保字段正确创建。

---

## 🔧 第二步：启动后端

打开第一个终端窗口：

```powershell
# 进入后端目录
cd backend

# 启动后端服务
mvn spring-boot:run
```

**或者使用IDEA**：
1. 打开 `backend` 文件夹
2. 找到 `AiWritingApplication.java`
3. 右键 → Run

**成功标志**：
```
🚀 Tomcat started on port(s): 8080 (http)
✅ AI五感作文训练平台后端已启动成功！
```

---

## 💻 第三步：启动前端

打开第二个终端窗口：

```powershell
# 进入前端目录
cd frontend

# 安装依赖（首次运行需要）
npm install

# 启动前端服务
npm run dev
```

**成功标志**：
```
VITE ready in 500 ms
➜  Local:   http://localhost:5173/
```

---

## 🌐 第四步：访问系统

在浏览器中打开：**http://localhost:5173**

你应该看到登录页面！

---

## ✅ 验证新功能

### 测试对比功能

1. **注册并登录学生账号**
   - 用户名: `student01`
   - 密码: `123456`
   - 角色: 学生

2. **提交第一篇作文**
   - 题目: `我的暑假生活`
   - 内容: `今年暑假，我去了海边...`（随便写）
   - 不要打开对比开关
   - 点击"提交并获取AI反馈"
   - 等待AI反馈

3. **提交第二篇作文（启用对比）**
   - 题目: `我的寒假计划`
   - 内容: `寒假到了，我计划...`（随便写）
   - **✓ 打开"与历史作文对比"开关**
   - 选择刚才提交的"我的暑假生活"
   - 点击"提交并获取AI反馈"
   - 等待对比分析（会比普通模式慢一些）

4. **查看AI反馈**
   - 应该能看到：
     - 新作文评分
     - 五感运用点评
     - 对比分析（进步情况）
     - 五感训练建议

---

## 📊 启动检查清单

### 后端 ✅
- [ ] MySQL服务已启动
- [ ] 数据库已创建或迁移完成
- [ ] 后端运行在 http://localhost:8080
- [ ] 没有数据库连接错误

### 前端 ✅
- [ ] Node.js已安装
- [ ] 前端运行在 http://localhost:5173
- [ ] 能看到登录页面

### 功能 ✅
- [ ] 能注册用户
- [ ] 能登录系统
- [ ] 能提交作文
- [ ] 能看到对比选择功能
- [ ] 对比功能正常返回AI反馈

---

## 🐛 常见问题

### 问题1: 数据库字段不存在
**错误**: `Unknown column 'previous_record_id'`

**解决**: 执行数据库迁移（见第一步）

### 问题2: 对比功能返回普通反馈
**原因**: AI API调用失败或timeout

**解决**: 
- 检查网络连接
- 检查 `application.yml` 中的API配置
- 查看后端日志

### 问题3: 前端显示错误
**错误**: `Failed to fetch`

**解决**: 
- 确认后端已启动
- 确认后端端口是8080
- 检查浏览器控制台错误信息

---

## 🎯 快速启动命令（复制粘贴）

```powershell
# 终端1 - 后端
cd backend && mvn spring-boot:run

# 终端2 - 前端
cd frontend && npm install && npm run dev
```

然后访问: **http://localhost:5173**

---

## 📝 新增功能说明

### 对比功能特点
1. **五感训练法为重点** - 所有分析和评分都围绕五感描写
2. **详细进步分析** - 指出两篇作文在五感描写上的具体进步
3. **成长曲线同步** - 新作文仍会计入成长曲线
4. **历史记录保留** - 对比分析结果保存到数据库

### 评分标准
- 五感描写: 30分
- 内容充实: 30分
- 结构完整: 20分
- 语言表达: 20分

---

## 💡 使用技巧

1. **先写一篇普通作文** - 熟悉功能
2. **再用对比功能** - 选择第一篇作文进行对比
3. **查看详细反馈** - AI会从五感角度详细分析
4. **关注成长曲线** - 每次提交都会更新

---

## 🎉 完成！

当你看到：
- ✅ 后端控制台显示启动成功
- ✅ 前端页面正常显示
- ✅ 对比功能能正常使用

**恭喜！你的系统已成功运行！** 🎊



